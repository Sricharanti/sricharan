###################################################################################################################
# Scenario: L_DD_USBHost_00011_1
# Author  : Axel Casta¤eda Gonzalez
# Date    : November 30, 2006
# Description: Fax-Modem Testing
###################################################################################################################

foo 	echo L_DD_USBHost_0011_1
#0  insmod /testsuites/usb_host/mods/g_zero.ko
0  set -x; echo -e '\n\n\tTesting the use of a CDC-ACM modem \n\n' && sleep $DELAY1 && if [ $USB_DRIVER = "MENTOR" ] ; then  echo -e '\n\n\t HSUSB HOST\n\n' && insmod $MODULE_PATH/g_zero.ko; else  echo -e '\n\n\t  FSUSB HOST \n'; fi && exit 0 || exit 1

#Loading modem module

#1  insmod /testsuites/usb_host/mods/cdc-acm.ko
#1  set -x; insmod $MODULE_PATH/cdc-acm.ko && exit 0 || exit 1

2  set -x; echo -e '\n\n\t Connect modem device to USB port \n\n' && sleep $DELAY3 && exit 0 || exit 1

#3  echo 'F' > /proc/driver/musb_hdrc
3  set -x; if [ $USB_DRIVER = "MENTOR" ] ; then  echo 'F' > $PROC_INT && sleep $DELAY2 ; fi  && exit 0 || exit 1

#Checking return codes 

#4  cat  /proc/bus/usb/devices | grep 'cdc'
4  set -x; echo -e '\n\n\t Checking modem return codes \n\n' && cat $ENUM_COMM | grep 'cdc' && sleep $DELAY1 && exit 0 || exit 1

#5  /testsuites/usb_host/bin/microcom -D/dev/ttyACM0
5  set -x; echo -e 'AT\n' | ${TESTBIN}/microcom -D/dev/ttyACM0 && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep 'OK' && exit 0 || exit 1
6  set -x; echo -e 'ati6\n' | ${TESTBIN}/microcom -D/dev/ttyACM0 && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep 'RCV56DPF' && exit 0 || exit 1
7  set -x; echo -e 'ati3\n' | ${TESTBIN}/microcom -D/dev/ttyACM0 && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep 'Zoom' && exit 0 || exit 1
8  set -x; echo -e 'at#ud\n' | ${TESTBIN}/microcom -D/dev/ttyACM0 && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep 'DIAG' && exit 0 || exit 1 
9  set -x; echo -e 'AT&V\n' | ${TESTBIN}/microcom -D/dev/ttyACM0  && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep 'PROFILE'&& exit 0 || exit 1
10  set -x; echo -e 'at&v1\n' | ${TESTBIN}/microcom -D/dev/ttyACM0 && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep '...'&& exit 0 || exit 1
11  set -x; echo -e 'at&v2\n' | ${TESTBIN}/microcom -D/dev/ttyACM0 && sleep $DELAY1 && echo '~b' | ${TESTBIN}/microcom -D/dev/ttyACM0 | grep 'BEGIN' && exit 0 || exit 1

#Unloading modem module
12  set -x; rmmod cdc-acm && exit 0 || exit 1
13 set -x; if [ $USB_DRIVER = "MENTOR" ] ; then    rmmod g_zero.ko ; fi && exit 0 || exit 1
bar 	echo L_DD_USBHost_0011_1
