#################################################################################
# Scenario: L_DD_USBEHCI_0001
# Author  : Diego Zavala Trujillo
# Date    : Feb 6, 2009
# Description: Enumeration with various devices and hubs, Mass Storage, ICCD
#	Serial Converter.
# ChangeLog:
#	6 Feb 2009 - Diego Zavala Trujillo - Adapting scenario from Host to EHCI.
#################################################################################

foo	echo L_DD_USBEHCI_0001

0  set -x; insmod $MODULE_PATH/ehci-hcd.ko  &&  echo -e "\n\n\t Testing enumeration with MassStorage, ICCD, and SerialConverter. \n\n" &&  sleep $DELAY1  &&  echo "0" > $LOGBASE/log.panresult; exit 0 || echo -e "\n\n\t ERROR1 - No module found. \n\n"; echo "1" > $LOGBASE/log.panresult; exit 1

1  if [ `cat $LOGBASE/log.panresult` = 0 ]; then echo on > $ECHI_LEVEL  &&  echo -e "\n\n\t Turning on the echi device \n\n"  &&  exit 0 || exit 1; else echo -e "\n\n\t ERROR1 - Could not run this test because the module has not been inserted. \n\n"; exit 1; fi

##  Checking mass storage device enumeration
2  if [ `cat $LOGBASE/log.panresult` = 0 ]; then export DEVICE_NAME="mass storage"; export ENUM_INFO="stor"; export LEV="01"; if [ $USB_DRIVER = "SYNOPSIS" ] ; then  export SPEED="480" ; else  export SPEED="12" ; fi  &&  ${TESTROOT}/test_runner.sh -p L_DD_USBEHCI_0001_core  &&  exit 0 || exit 1; else echo -e "\n\n\t ERROR1 - Could not run this test because the module has not been inserted. \n\n"; exit 1; fi

##  Checking ICCD device enumeration
3   if [ `cat $LOGBASE/log.panresult` = 0 ]; then export DEVICE_NAME="iccd";  export ENUM_INFO="stor" ; export LEV="01"; export SPEED="480"; ${TESTROOT}/test_runner.sh -p L_DD_USBEHCI_0001_core  &&  exit 0 || exit 1; else echo -e "\n\n\t ERROR1 - Could not run this test because the module has not been inserted. \n\n"; exit 1; fi

##  Checking HS-HUB enumeration
4   if [ `cat $LOGBASE/log.panresult` = 0 ]; then export DEVICE_NAME="hub";  export ENUM_INFO="hub"; export LEV="01"; export SPEED="480";   ${TESTROOT}/test_runner.sh -p L_DD_USBEHCI_0001_core  && exit 0 || exit 1; else echo -e "\n\n\t ERROR1 - Could not run this test because the module has not been inserted. \n\n"; exit 1; fi

##  Checking usb serial device enumeration
5   if [ `cat $LOGBASE/log.panresult` = 0 ]; then export DEVICE_NAME="serial adapter";    export ENUM_INFO="Keyspan" ; export LEV="02";   export SPEED="12";    ${TESTROOT}/test_runner.sh -p L_DD_USBEHCI_0001_core  && exit 0 || exit 1; else echo -e "\n\n\t ERROR1 - Could not run this test because the module has not been inserted. \n\n"; exit 1; fi

6  set -x; rmmod ehci-hcd.ko  &&  exit 0 || exit 1

bar	echo L_DD_USBEHCI_0001
