###################################################################################################################
# Scenario: L_DD_MMC_0007E
# Author  : Misael Lopez Cruz
# Date    : September 20, 2006
# Description: Test Power Management capabilities of MMC driver
###################################################################################################################

# Begin L_DD_MMC_0007E

setup_1 mkdir $MOUNT_POINT1; echo -e "n\n p\n 1\n $START_SECTOR_DEV1\n $END_SECTOR_DEV1\n w\n" | fdisk $ROOT_ENTRY_DEV1 && $TESTBIN/mke2fs $PARTITION1_ENTRY_DEV1 &&  mount -t ext2 $PARTITION1_ENTRY_DEV1 $MOUNT_POINT1 && exit 0 || exit 1
setup_2 mkdir $MOUNT_POINT2; echo -e "n\n p\n 1\n $START_SECTOR_DEV2\n $END_SECTOR_DEV2\n w\n" | fdisk $ROOT_ENTRY_DEV2 && $TESTBIN/mke2fs $PARTITION1_ENTRY_DEV2 &&  mount -t ext2 $PARTITION1_ENTRY_DEV2 $MOUNT_POINT2 && exit 0 || exit 1

0001_1	echo $SUSPEND_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && exit 0 || exit 1
0001_2	echo $SUSPEND_COMMAND > $SYSFS_POWER_ENTRY_DEV2 && exit 0 || exit 1
0002_1	echo $SUSPEND_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && exit 0 || exit 1
0002_2	echo $SUSPEND_COMMAND > $SYSFS_POWER_ENTRY_DEV2 && exit 0 || exit 1
0003_1	echo "Remove and insert MMC card 1" && echo "MMC card should not be detected" && sleep 1 && $UTILBIN/akey && exit 0 || exit 1
0003_2	echo "Remove and insert MMC card 2" && echo "MMC card should not be detected" && sleep 1 && $UTILBIN/akey && exit 0 || exit 1
0004_1	echo $RESUME_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && ls $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0004_2  echo $RESUME_COMMAND > $SYSFS_POWER_ENTRY_DEV2 && ls $ROOT_ENTRY_DEV2 && exit 0 || exit 1
0005_1  echo $RESUME_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && ls $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0005_2  echo $RESUME_COMMAND > $SYSFS_POWER_ENTRY_DEV2 && ls $ROOT_ENTRY_DEV2 && exit 0 || exit 1
0006 	echo -e "$SLEEP_OPTION\n$QUIT_OPTION\n" | $DPM_SCRIPT && exit 0 || exit 1
0007	echo -e "$SLEEP_OPTION\n$QUIT_OPTION\n" | $DPM_SCRIPT && exit 0 || exit 1
0008	(cp $TESTROOT/$BIG_FILE $MOUNT_POINT1 &) && (cp $TESTROOT/$BIG_FILE $MOUNT_POINT2 &) && echo -e "$SLOW_MODE\n$QUIT_OPTION\n" | $DPM_SCRIPT && sleep 30 && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT1/$BIG_FILE && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT2/$BIG_FILE && exit 0 || exit 1
0008_cleanup rm $MOUNT_POINT1/$BIG_FILE && rm $MOUNT_POINT2/$BIG_FILE && exit 0 || exit 1
0009    (cp $TESTROOT/$BIG_FILE $MOUNT_POINT1 &) && (cp $TESTROOT/$BIG_FILE $MOUNT_POINT2 &) && echo -e "$FAST_MODE\n$QUIT_OPTION\n" | $DPM_SCRIPT && sleep 30 &&  cmp $TESTROOT/$BIG_FILE $MOUNT_POINT1/$BIG_FILE && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT2/$BIG_FILE && exit 0 || exit 1
0009_cleanup rm $MOUNT_POINT1/$BIG_FILE && rm $MOUNT_POINT2/$BIG_FILE && exit 0 || exit 1
0010    (cp $TESTROOT/$BIG_FILE $MOUNT_POINT1 &) && (cp $TESTROOT/$BIG_FILE $MOUNT_POINT2 &) && echo -e "$SCALE_OPTION\n$QUIT_OPTION\n" | $DPM_SCRIPT && sleep 30 && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT1/$BIG_FILE && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT2/$BIG_FILE && exit 0 || exit 1
0010_cleanup rm $MOUNT_POINT1/$BIG_FILE && rm $MOUNT_POINT2/$BIG_FILE && exit 0 || exit 1

cleanup_1 umount $MOUNT_POINT1 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV1 && rm -rf $MOUNT_POINT1 && exit 0 || exit 1
cleanup_2 umount $MOUNT_POINT2 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV2 && rm -rf $MOUNT_POINT2 && exit 0 || exit 1

# End L_DD_MMC_0007E
