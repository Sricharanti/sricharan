###################################################################################################################
# Scenario: L_DD_MMC_0007C
# Author  : Misael Lopez Cruz
# Date    : September 20, 2006
# Description: Test if operations on partitions are possible in MMC device
###################################################################################################################

# Begin L_DD_MMC_0007C

setup_1	mkdir $MOUNT_POINT1; mkdir $MOUNT_POINT3; exit 0
setup_2	mkdir $MOUNT_POINT2; mkdir $MOUNT_POINT4; exit 0

0001_1a set -x;	echo -e "n\n p\n 1\n $START_SECTOR_DEV1\n $END_SECTOR_DEV1\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0001_1b cat /proc/partitions | grep $PARTITION1_NAME_DEV1 && exit 0 || exit 1
0001_2a set -x;  echo -e "n\n p\n 1\n $START_SECTOR_DEV2\n $END_SECTOR_DEV2\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1
0001_2b cat /proc/partitions | grep $PARTITION1_NAME_DEV2 && exit 0 || exit 1

0002_1a set -x; echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0002_1b cat /proc/partitions | grep $PARTITION1_ENTRY_DEV1 && exit 1 || exit 0
0002_2a set -x; echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1
0002_2b cat /proc/partitions | grep $PARTITION1_ENTRY_DEV2 && exit 1 || exit 0

0003_setup1 set -x; echo -e "n\n p\n 1\n $START_SECTOR_DEV1\n $END_SECTOR_DEV1\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0003_setup2 set -x; echo -e "n\n p\n 1\n $START_SECTOR_DEV2\n $END_SECTOR_DEV2\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1
0003_1a	$TESTBIN/mkdosfs $PARTITION1_ENTRY_DEV1 && exit 0 || exit 1
0003_1b mount -t vfat $PARTITION1_ENTRY_DEV1 $MOUNT_POINT1 && exit 0 || exit 1
0003_1c mount | grep $PARTITION1_ENTRY_DEV1 | grep "vfat" && exit 0 || exit 1
0003_2a  $TESTBIN/mkdosfs $PARTITION1_ENTRY_DEV2 && exit 0 || exit 1
0003_2b mount -t vfat $PARTITION1_ENTRY_DEV2 $MOUNT_POINT2 && exit 0 || exit 1
0003_2c mount | grep $PARTITION1_ENTRY_DEV2 | grep "vfat" && exit 0 || exit 1
0003_cleanup1 set -x; umount $MOUNT_POINT1 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0003_cleanup2 set -x; umount $MOUNT_POINT2 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1

0004_setup1 set -x; echo -e "n\n p\n 1\n $START_SECTOR_DEV1\n $END_SECTOR_DEV1\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0004_setup2 set -x; echo -e "n\n p\n 1\n $START_SECTOR_DEV2\n $END_SECTOR_DEV2\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1

0004_1a $TESTBIN/mke2fs $PARTITION1_ENTRY_DEV1 && exit 0 || exit 1
0004_1b mount -t ext2 $PARTITION1_ENTRY_DEV1 $MOUNT_POINT1 && exit 0 || exit 1
0004_1c mount | grep $PARTITION1_ENTRY_DEV1 | grep "ext2" && exit 0 || exit 1
0004_2a $TESTBIN/mke2fs $PARTITION1_ENTRY_DEV2 && exit 0 || exit 1
0004_2b mount -t ext2 $PARTITION1_ENTRY_DEV2 $MOUNT_POINT2 && exit 0 || exit 1
0004_2c mount | grep $PARTITION1_ENTRY_DEV2 | grep "ext2" && exit 0 || exit 1
0004_cleanup1 set -x; umount $MOUNT_POINT1 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0004_cleanup2 set -x; umount $MOUNT_POINT2 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1

0005_setup1 set -x; echo -e "n\n p\n 1\n $START_SECTOR_DEV1\n $MIDDLE_SECTOR_DEV1\n n\n p\n 2\n $(echo $MIDDLE_SECTOR_DEV1+1|bc)\n $END_SECTOR_DEV1\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0005_setup2 set -x; echo -e "n\n p\n 1\n $START_SECTOR_DEV2\n $MIDDLE_SECTOR_DEV2\n n\n p\n 2\n $(echo $MIDDLE_SECTOR_DEV2+1|bc)\n $END_SECTOR_DEV2\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1

0005_1a	set -x; $TESTBIN/mkdosfs $PARTITION1_ENTRY_DEV1 && mount -t vfat $PARTITION1_ENTRY_DEV1 $MOUNT_POINT1 && exit 0 || exit 1
0005_1b set -x; $TESTBIN/mke2fs $PARTITION2_ENTRY_DEV1 && mount -t ext2 $PARTITION2_ENTRY_DEV1 $MOUNT_POINT3 && exit 0 || exit 1
0005_1c set -x; mount | grep $PARTITION1_ENTRY_DEV1 | grep "vfat" && exit 0 || exit 1
0005_1d set -x; mount | grep $PARTITION2_ENTRY_DEV1 | grep "ext2" && exit 0 || exit 1
0005_2a set -x; $TESTBIN/mkdosfs $PARTITION1_ENTRY_DEV2 && mount -t vfat $PARTITION1_ENTRY_DEV2 $MOUNT_POINT2 && exit 0 || exit 1
0005_2b set -x; $TESTBIN/mke2fs $PARTITION2_ENTRY_DEV2 && mount -t ext2 $PARTITION2_ENTRY_DEV2 $MOUNT_POINT4 && exit 0 || exit 1
0005_2c set -x; mount | grep $PARTITION1_ENTRY_DEV2 | grep "vfat" && exit 0 || exit 1
0005_2d set -x; mount | grep $PARTITION2_ENTRY_DEV2 | grep "ext2" && exit 0 || exit 1
0005_cleanup1 set -x; umount $MOUNT_POINT1 && umount $MOUNT_POINT3 && echo -e "d\n 1\n d\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0005_cleanup2 set -x; umount $MOUNT_POINT2 && umount $MOUNT_POINT4 && echo -e "d\n 1\n d\n w\n" | fdisk $ROOT_ENTRY_DEV2 && exit 0 || exit 1

# End L_DD_MMC_0007C
