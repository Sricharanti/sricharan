##################################################################################################################
# Scenario: L_DD_MMC_0004
# Author  : Misael Lopez Cruz
# Date    : September 20, 2006
# Description: Test Power Management capabilities of MMC driver
###################################################################################################################

foo 	echo "L_DD_MMC_0004"

setup	mkdir $MOUNT_POINT1; echo -e "n\n p\n 1\n $START_SECTOR_DEV1\n $END_SECTOR_DEV1\n w\n" | fdisk $ROOT_ENTRY_DEV1 && $TESTBIN/mke2fs $PARTITION1_ENTRY_DEV1 &&  mount -t ext2 $PARTITION1_ENTRY_DEV1 $MOUNT_POINT1 && exit 0 || exit 1

0001	echo $SUSPEND_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && exit 0 || exit 1
0002	echo $SUSPEND_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && exit 0 || exit 1
0003	echo "Remove and insert MMC card 1" && echo "MMC card should not be detected" && sleep 1 && $UTILBIN/akey && exit 0 || exit 1
0004	echo $RESUME_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && ls $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0005	echo $RESUME_COMMAND > $SYSFS_POWER_ENTRY_DEV1 && ls $ROOT_ENTRY_DEV1 && exit 0 || exit 1
0006 	echo -e "$SLEEP_OPTION\n$QUIT_OPTION\n" | $DPM_SCRIPT && exit 0 || exit 1
0007	echo -e "$SLEEP_OPTION\n$QUIT_OPTION\n" | $DPM_SCRIPT && exit 0 || exit 1
0008_a	(cp $TESTROOT/$BIG_FILE $MOUNT_POINT1 &) && echo -e "$SLOW_MODE\n$QUIT_OPTION\n" | $DPM_SCRIPT && sleep 30 && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT1/$BIG_FILE && exit 0 || exit 1
0008_b	rm $MOUNT_POINT1/$BIG_FILE && exit 0 || exit 1
0009_a	(cp $TESTROOT/$BIG_FILE $MOUNT_POINT1 &) && echo -e "$FAST_MODE\n$QUIT_OPTION\n" | $DPM_SCRIPT && sleep 30 && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT1/$BIG_FILE && exit 0 || exit 1
0009_b	rm $MOUNT_POINT1/$BIG_FILE && exit 0 || exit 1
0010_a	(cp $TESTROOT/$BIG_FILE $MOUNT_POINT1 &) && echo -e "$SCALE_OPTION\n$QUIT_OPTION\n" | $DPM_SCRIPT && sleep 30 && cmp $TESTROOT/$BIG_FILE $MOUNT_POINT1/$BIG_FILE && exit 0 || exit 1
0010_b	rm $MOUNT_POINT1/$BIG_FILE && exit 0 || exit 1

cleanup	umount $MOUNT_POINT1 && echo -e "d\n w\n" | fdisk $ROOT_ENTRY_DEV1 && exit 0 || exit 1

bar 	echo "L_DD_MMC_0004"

