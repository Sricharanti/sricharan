#####################
# FILENAME: L_DD_AUDIO_0001
# Author  : Nishanth Menon
# Date    : Wed Apr 26 11:38:48 CDT 2006
# Copyright (C) 2006 Texas Instruments
#
# Description:
# The Basic Audio Tests->Devfs checks

foo   echo "L_DD_AUDIO_0001"

# Check if the fs device exists
0001  cat /proc/devices|grep sound || exit 1

# Check for basic devfs device
0002a test -c /dev/sound/dsp && test -c /dev/sound/mixer || exit 1

# Check for filesystem devfs device
0002b test -c /dev/dsp && test -c /dev/mixer || exit 1

# Check if the devices are read/write/fullduplex operable
# Check individual
0003a dspopen read $DSP_DEVICE &&  dspopen write $DSP_DEVICE && dspopen readwrite $DSP_DEVICE || exit 1
0003b dspopen read $MIXER_DEVICE &&  dspopen write $MIXER_DEVICE && dspopen readwrite $MIXER_DEVICE || exit 1

# Check dsp against dsp second opening device should fail
0004a sleep 2; (dspopen read $DSP_DEVICE &) && (dspopen read  $DSP_DEVICE ) && exit 1 || exit 0
0004b sleep 2; (dspopen read $DSP_DEVICE &) && (dspopen write $DSP_DEVICE ) && exit 1 || exit 0
0004c sleep 2; (dspopen read $DSP_DEVICE &) && (dspopen readwrite $DSP_DEVICE ) && exit 1 || exit 0
004d sleep 2; (dspopen write $DSP_DEVICE &) && (dspopen write $DSP_DEVICE ) && exit 1 || exit 0
0004e sleep 2; (dspopen write $DSP_DEVICE &) && (dspopen read $DSP_DEVICE ) && exit 1 || exit 0
0004f sleep 2; (dspopen write $DSP_DEVICE &) && (dspopen readwrite $DSP_DEVICE ) && exit 1 || exit 0
0004g sleep 2; (dspopen readwrite $DSP_DEVICE &) && (dspopen readwrite $DSP_DEVICE ) && exit 1 || exit 0
0004h sleep 2; (dspopen readwrite $DSP_DEVICE &) && (dspopen read $DSP_DEVICE ) && exit 1 || exit 0
0004i sleep 2; (dspopen readwrite $DSP_DEVICE &) && (dspopen write $DSP_DEVICE ) && exit 1 || exit 0

# Mixer against mixer - both should pass
0004j (dspopen read $MIXER_DEVICE &) && (dspopen read $MIXER_DEVICE ) && exit 0 || exit 1

# Mixer against Dsp - both should pass
0004k (dspopen read $MIXER_DEVICE &) && (dspopen read $DSP_DEVICE ) && exit 0 || exit 1
0004l (dspopen read $MIXER_DEVICE &) && (dspopen write $DSP_DEVICE ) && exit 0 || exit 1
0004m (dspopen read $MIXER_DEVICE &) && (dspopen readwrite $DSP_DEVICE ) && exit 0 || exit 1
0004n (dspopen read $DSP_DEVICE &) && (dspopen read $MIXER_DEVICE ) && exit 0 || exit 1
0004o (dspopen write $DSP_DEVICE &) && (dspopen read $MIXER_DEVICE ) && exit 0 || exit 1
0004p (dspopen readwrite $DSP_DEVICE &) && (dspopen read $MIXER_DEVICE ) && exit 0 || exit 1

bar   echo "L_DD_AUDIO_0001"
