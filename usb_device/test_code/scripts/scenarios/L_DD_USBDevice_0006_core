################################################################################
# Scenario: L_DD_USBDevice_0006_core
# Author  : Diego Zavala Trujillo
# Date    : December 4, 2006
# Description: Testing USB-Serial Funtionality
# ChangLog:
#	DD MM YYYY - Name - Description
#	* pending to file where the Linux pc receives the information form the
#	* USB0 port
#	* You can open on the Linux PC minicom -s and change the port to
#	* /dev/ttyUSB0, and start sending and receiving data.
################################################################################

foo	echo L_DD_USBDevice_0006_core

1  set -x; mknod /dev/ttygs0 c 127 0 && exit 0 || exit 0

2  export MODULE="usbserial vendor=0x0525 product=0xa4a6";  $TESTSCRIPT/enum.sh insertRemoteModule  &&  exit 0 || exit 1

3  set -x; ssh root@$REMOTE_IP -i $SSH_PATH mknod /dev/ttyUSB0 c 188 0  &&  exit 0 || exit 0

4  export ENUM_INFO="Gadget Serial"; echo -e "\n\n\t Checking for ${ENUM_INFO} enumeration on the Linux PC \n\n"  && $TESTSCRIPT/enum.sh connectHostRemote  &&  exit 0 || exit

5  export ENUM_INFO="usbserial"; echo -e "\n\n\t Checking for ${ENUM_INFO} enumeration on the Linux PC \n\n"  &&  $TESTSCRIPT/enum.sh connectHostRemote

### From OMAP to Linux PC

6  echo -e "\n\n\t Sending data from OMAP to LinuxPC \n cat file2send-OMAP > /dev/ttygs0 \n\n"  &&  ((ssh root@$REMOTE_IP -i $SSH_PATH cat /dev/ttyUSB0) & (cat $MISC_PATH/file2send-OMAP > /dev/ttygs0)) > $LOGBASE/log.serial-OMAPSide  &&  sleep $DELAY1  &&  exit 0 || exit 1

#6  echo -e "\n\n\t Sending data from OMAP to LinuxPC \n cat file2send-OMAP > /dev/ttygs0 \n\n"  &&  (((ssh root@$REMOTE_IP -i $SSH_PATH cat /dev/ttyUSB0) & (cat $MISC_PATH/file2send-OMAP > /dev/ttygs0)) > (ssh root@$REMOTE_IP -i $SSH_PATH $REMOTE_PATH/log.serial-OMAPSide))  &&  exit 0 || exit 1

#7  cat $LOGBASE/log.serial-OMAPSide | grep "send it by the the OMAP to the Linux PC"  &&  echo -e "\n\n\t Message from OMAP was successfully received  \n\n"  &&  rm -rf $LOGBASE/log.serial-OMAPSide  &&  sleep $DELAY1  && exit 0 || exit 1

### From Linux PC to OMAP

8  echo -e "\n\n\t Sending data from LinuxPC to OMAP \n cat file2send-PC > /dev/ttyUSB0 \n\n"  &&  ((cat /dev/ttygs0)  &  (sleep $DELAY2 && ssh root@$REMOTE_IP -i $SSH_PATH  cat $REMOTE_PATH/file2send-PC )) > $LOGBASE/log.serial-PCSide  &&  exit 0 || exit 1

9 cat $LOGBASE/log.serial-PCSide | grep "send it by the the Linux PC to the OMAP"  &&  echo -e "\n\n\t Message from Linux PC was successfully received on the OMAP \n\n"  &&  rm -rf $LOGBASE/log.serial-PCSide  &&  sleep $DELAY1 &&  exit 0  || exit 1

10  export MODULE="usbserial";  $TESTSCRIPT/enum.sh removeRemoteModule  &&  exit 0 || exit 1

bar	echo L_DD_USBDevice_0006_core
