From 109e9a3f3a123781e3a8be2036ae329b00ebf800 Mon Sep 17 00:00:00 2001
From: Abhijit Pagare <abhijitpagare@ti.com>
Date: Wed, 10 Feb 2010 18:48:55 +0530
Subject: [PATCH] ARM: OMAP4: powerdomains: Export Power Domain APIs.

Export API's for testing the power domain framework

Signed-off-by: Abhijit Pagare <abhijitpagare@ti.com>

--
 arch/arm/plat-omap/include/plat/powerdomain.h |   70 +++++++++++++-------------
 arch/arm/plat-omap/powerdomain.c              |   10 +++
 2 files changed, 45 insertions(+), 35 deletions(-)
---

Index: kernel-omap4/arch/arm/plat-omap/include/plat/powerdomain.h
===================================================================
--- kernel-omap4.orig/arch/arm/plat-omap/include/plat/powerdomain.h	2010-08-17 12:55:20.604167595 +0530
+++ kernel-omap4/arch/arm/plat-omap/include/plat/powerdomain.h	2010-08-17 12:55:39.120177811 +0530
@@ -139,49 +139,49 @@
	int (*pwrdm_wait_transition)(struct powerdomain *pwrdm);
 };
 
-void pwrdm_init(struct powerdomain **pwrdm_list, struct pwrdm_functions *custom_funcs);
+extern void pwrdm_init(struct powerdomain **pwrdm_list, struct pwrdm_functions *custom_funcs);
 
-struct powerdomain *pwrdm_lookup(const char *name);
+extern struct powerdomain *pwrdm_lookup(const char *name);
 
-int pwrdm_for_each(int (*fn)(struct powerdomain *pwrdm, void *user),
+extern int pwrdm_for_each(int (*fn)(struct powerdomain *pwrdm, void *user),
 			void *user);
-int pwrdm_for_each_nolock(int (*fn)(struct powerdomain *pwrdm, void *user),
+extern int pwrdm_for_each_nolock(int (*fn)(struct powerdomain *pwrdm, void *user),
 			void *user);
 
-int pwrdm_add_clkdm(struct powerdomain *pwrdm, struct clockdomain *clkdm);
-int pwrdm_del_clkdm(struct powerdomain *pwrdm, struct clockdomain *clkdm);
-int pwrdm_for_each_clkdm(struct powerdomain *pwrdm,
+extern int pwrdm_add_clkdm(struct powerdomain *pwrdm, struct clockdomain *clkdm);
+extern int pwrdm_del_clkdm(struct powerdomain *pwrdm, struct clockdomain *clkdm);
+extern int pwrdm_for_each_clkdm(struct powerdomain *pwrdm,
 			 int (*fn)(struct powerdomain *pwrdm,
 				   struct clockdomain *clkdm));
 
-int pwrdm_get_mem_bank_count(struct powerdomain *pwrdm);
+extern int pwrdm_get_mem_bank_count(struct powerdomain *pwrdm);
 
-int pwrdm_set_next_pwrst(struct powerdomain *pwrdm, u8 pwrst);
-int pwrdm_read_next_pwrst(struct powerdomain *pwrdm);
-int pwrdm_read_pwrst(struct powerdomain *pwrdm);
-int pwrdm_read_prev_pwrst(struct powerdomain *pwrdm);
-int pwrdm_clear_all_prev_pwrst(struct powerdomain *pwrdm);
-
-int pwrdm_set_logic_retst(struct powerdomain *pwrdm, u8 pwrst);
-int pwrdm_set_mem_onst(struct powerdomain *pwrdm, u8 bank, u8 pwrst);
-int pwrdm_set_mem_retst(struct powerdomain *pwrdm, u8 bank, u8 pwrst);
-
-int pwrdm_read_logic_pwrst(struct powerdomain *pwrdm);
-int pwrdm_read_prev_logic_pwrst(struct powerdomain *pwrdm);
-int pwrdm_read_logic_retst(struct powerdomain *pwrdm);
-int pwrdm_read_mem_pwrst(struct powerdomain *pwrdm, u8 bank);
-int pwrdm_read_prev_mem_pwrst(struct powerdomain *pwrdm, u8 bank);
-int pwrdm_read_mem_retst(struct powerdomain *pwrdm, u8 bank);
-
-int pwrdm_enable_hdwr_sar(struct powerdomain *pwrdm);
-int pwrdm_disable_hdwr_sar(struct powerdomain *pwrdm);
-bool pwrdm_has_hdwr_sar(struct powerdomain *pwrdm);
-
-int pwrdm_wait_transition(struct powerdomain *pwrdm);
-
-int pwrdm_state_switch(struct powerdomain *pwrdm);
-int pwrdm_clkdm_state_switch(struct clockdomain *clkdm);
-int pwrdm_pre_transition(void);
-int pwrdm_post_transition(void);
+extern int pwrdm_set_next_pwrst(struct powerdomain *pwrdm, u8 pwrst);
+extern int pwrdm_read_next_pwrst(struct powerdomain *pwrdm);
+extern int pwrdm_read_pwrst(struct powerdomain *pwrdm);
+extern int pwrdm_read_prev_pwrst(struct powerdomain *pwrdm);
+extern int pwrdm_clear_all_prev_pwrst(struct powerdomain *pwrdm);
+
+extern int pwrdm_set_logic_retst(struct powerdomain *pwrdm, u8 pwrst);
+extern int pwrdm_set_mem_onst(struct powerdomain *pwrdm, u8 bank, u8 pwrst);
+extern int pwrdm_set_mem_retst(struct powerdomain *pwrdm, u8 bank, u8 pwrst);
+
+extern int pwrdm_read_logic_pwrst(struct powerdomain *pwrdm);
+extern int pwrdm_read_prev_logic_pwrst(struct powerdomain *pwrdm);
+extern int pwrdm_read_logic_retst(struct powerdomain *pwrdm);
+extern int pwrdm_read_mem_pwrst(struct powerdomain *pwrdm, u8 bank);
+extern int pwrdm_read_prev_mem_pwrst(struct powerdomain *pwrdm, u8 bank);
+extern int pwrdm_read_mem_retst(struct powerdomain *pwrdm, u8 bank);
+
+extern int pwrdm_enable_hdwr_sar(struct powerdomain *pwrdm);
+extern int pwrdm_disable_hdwr_sar(struct powerdomain *pwrdm);
+extern bool pwrdm_has_hdwr_sar(struct powerdomain *pwrdm);
+
+extern int pwrdm_wait_transition(struct powerdomain *pwrdm);
+
+extern int pwrdm_state_switch(struct powerdomain *pwrdm);
+extern int pwrdm_clkdm_state_switch(struct clockdomain *clkdm);
+extern int pwrdm_pre_transition(void);
+extern int pwrdm_post_transition(void);
 
 #endif
Index: kernel-omap4/arch/arm/plat-omap/powerdomain.c
===================================================================
--- kernel-omap4.orig/arch/arm/plat-omap/powerdomain.c	2010-08-17 12:56:03.368188689 +0530
+++ kernel-omap4/arch/arm/plat-omap/powerdomain.c	2010-08-17 12:56:23.180178275 +0530
@@ -206,6 +206,7 @@

	return pwrdm;
 }
+EXPORT_SYMBOL(pwrdm_lookup);

 /**
  * pwrdm_for_each - call function on each registered clockdomain
@@ -282,6 +283,7 @@
 pac_exit:
	return ret;
 }
+EXPORT_SYMBOL(pwrdm_add_clkdm);

 /**
  * pwrdm_del_clkdm - remove a clockdomain from a powerdomain
@@ -322,6 +324,7 @@
 pdc_exit:
	return ret;
 }
+EXPORT_SYMBOL(pwrdm_del_clkdm);

 /**
  * pwrdm_for_each_clkdm - call function on each clkdm in a pwrdm
@@ -365,6 +368,7 @@

	return pwrdm->banks;
 }
+EXPORT_SYMBOL(pwrdm_get_mem_bank_count);

 /**
  * pwrdm_set_next_pwrst - set next powerdomain power state
@@ -395,6 +399,7 @@

	return ret;
 }
+EXPORT_SYMBOL(pwrdm_set_next_pwrst);

 /**
  * pwrdm_read_next_pwrst - get next powerdomain power state
@@ -416,6 +421,7 @@

	return ret;
 }
+EXPORT_SYMBOL(pwrdm_read_next_pwrst);

 /**
  * pwrdm_read_pwrst - get current powerdomain power state
@@ -437,6 +443,7 @@

	return ret;
 }
+EXPORT_SYMBOL(pwrdm_read_pwrst);

 /**
  * pwrdm_read_prev_pwrst - get previous powerdomain power state
@@ -488,6 +495,7 @@

	return ret;
 }
+EXPORT_SYMBOL(pwrdm_set_logic_retst);

 /**
  * pwrdm_set_mem_onst - set memory power state while powerdomain ON
@@ -585,6 +593,7 @@

	return ret;
 }
+EXPORT_SYMBOL(pwrdm_read_logic_pwrst);

 /**
  * pwrdm_read_prev_logic_pwrst - get previous powerdomain logic power state
@@ -627,6 +636,7 @@

	return ret;
 }
+EXPORT_SYMBOL(pwrdm_read_logic_retst);

 /**
  * pwrdm_read_mem_pwrst - get current memory bank power state
