###############################################################################
# Scenario: L_DD_POWER_1011_0001
# Author  : Leed Aguilar
# Date    : 11/15/11
# Testing : Verify that DPLL cascade feature is used in Audio playback scenario
#           when a headset/headphone is connected and display is off
# Results : Verify that the system enters to OPP25 in all power domains (CORE,
#           MPU, IVA) during the audio playback usecase with headset or
#           headphones connected and display off. The system must exit DPLL
#           cascade mode when display is turned on
###############################################################################

# Begin L_DD_POWER_1011_0001

# Set the max screen timeout (30 min)
0001 set -x; handlerAndroidSqlite3.sh set "system" "screen_off_timeout" "1800000"

# Set the device in airplane mode
0002 set -x; handlerAndroidSqlite3.sh set "system" "airplane_mode_on" "1"

# set a dummy wakelock to avoid going to suspend
0003 set -x; handlerAndroidPM.sh wakelock hold dummy

# Verify that the screen is ON
0004 set -x; android_display_switch.sh ON

# Verify Headset/Headphones are connected
0005 set -x; if [ `cat $SYSFS_H2W_STATE` -eq 0 ]; then exit 1; else exit 0; fi

# Close any instance of the MP3 player app running in the background
0006 set -x; handlerActivityManager.sh audio_playback stop && sleep 3

# Start Audio playback usecase: Play an MP3
0007 set -x; handlerActivityManager.sh audio_playback start $MP3_FILE

# Turn the display off after 10 seconds of audio playback
0007 set -x; sleep 10 && android_display_switch.sh OFF

# Is the system in DPLL cascade mode
0008 set -x; sleep 10; echo "TODO: how to verify if the system enters DPLL cascade mode"

# Turn the display on
0009 set -x; android_display_switch.sh ON

0010 set -x; sleep 2; echo "TODO: how to verify if the system exit is DPLL cascade mode"

# Close the MP3 player app
0011 set -x; handlerActivityManager.sh audio_playback stop

# Release dummy wakelock
0012 set -x; handlerAndroidPM.sh wakelock release dummy

# Restore system configuration:
# Disable airplane mode to conclude the test
0013 set -x; handlerAndroidSqlite3.sh set "system" "airplane_mode_on" "0"
0014 set -x; android_display_switch.sh ON

# End L_DD_POWER_1011_0001
